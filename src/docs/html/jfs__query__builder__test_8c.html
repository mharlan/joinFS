<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>joinFS: tests/jfs_query_builder_test.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>tests/jfs_query_builder_test.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;<a class="el" href="sqlitedb_8h_source.html">sqlitedb.h</a>&quot;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="jfs__query__builder__test_8c.html#a0cad294d05664a3f9e84977f9d12f24c">TEST_FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;1 2 3 4 5 6 7 8 9 10 %s 11 12 13 14 15 16 17 18 19 20 %s 21 22 23 24 25 26 27 28 29 30 %s 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170&quot;</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="jfs__query__builder__test_8c.html#a90621bf5b0b41049f3df5d6ecd4bd5e4">jfs_query_builder</a> (char **query, const char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="jfs__query__builder__test_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a0cad294d05664a3f9e84977f9d12f24c"></a><!-- doxytag: member="jfs_query_builder_test.c::TEST_FORMAT" ref="a0cad294d05664a3f9e84977f9d12f24c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TEST_FORMAT&nbsp;&nbsp;&nbsp;&quot;1 2 3 4 5 6 7 8 9 10 %s 11 12 13 14 15 16 17 18 19 20 %s 21 22 23 24 25 26 27 28 29 30 %s 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a90621bf5b0b41049f3df5d6ecd4bd5e4"></a><!-- doxytag: member="jfs_query_builder_test.c::jfs_query_builder" ref="a90621bf5b0b41049f3df5d6ecd4bd5e4" args="(char **query, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int jfs_query_builder </td>
          <td>(</td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment">{
  va_list args;
  
  <span class="keywordtype">char</span> *new_query;
  
  <span class="keywordtype">int</span> query_size;
  <span class="keywordtype">int</span> <a class="code" href="structjfs__db__op.html#a4364863dc28a00f88281e69331a97874">rc</a>;
  
  query_size = JFS_QUERY_INC;
  new_query = malloc(<span class="keyword">sizeof</span>(*new_query) * query_size);
  <span class="keywordflow">if</span>(!new_query) {
    <span class="keywordflow">return</span> -ENOMEM;
  }
  
  <span class="keywordflow">while</span>(1) {
    va_start(args, format);
    rc = vsnprintf(new_query, query_size, format, args);
    va_end(args);
    
    <span class="keywordflow">if</span>(rc &gt; -1 &amp;&amp; rc &lt; query_size) {
      <span class="keywordflow">break</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc &gt; -1) {
      query_size = rc + 1;
    }
    <span class="keywordflow">else</span> {
      <span class="keywordflow">if</span>(errno == EILSEQ) {
        <span class="keywordflow">return</span> -errno;
      }
      
      query_size += JFS_QUERY_INC;
    }

    free(new_query);
    new_query = malloc(<span class="keyword">sizeof</span>(*new_query) * query_size);
    <span class="keywordflow">if</span>(!new_query) {
      <span class="keywordflow">return</span> -ENOMEM;
    }
  }

  *<a class="code" href="structjfs__db__op.html#acf46a873006bb123d601b6a6914c58a6">query</a> = new_query;
  
  <span class="keywordflow">return</span> 0;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a><!-- doxytag: member="jfs_query_builder_test.c::main" ref="ae66f6b31b5ad750f1fe042a706a4e3d4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> *test;

  <span class="keywordtype">int</span> <a class="code" href="structjfs__db__op.html#a4364863dc28a00f88281e69331a97874">rc</a>;

  printf(<span class="stringliteral">&quot;Format length:%d\n&quot;</span>, strlen(<a class="code" href="jfs__query__builder__test_8c.html#a0cad294d05664a3f9e84977f9d12f24c">TEST_FORMAT</a>));

  rc = <a class="code" href="jfs__query__builder__test_8c.html#a90621bf5b0b41049f3df5d6ecd4bd5e4">jfs_query_builder</a>(&amp;test, <a class="code" href="jfs__query__builder__test_8c.html#a0cad294d05664a3f9e84977f9d12f24c">TEST_FORMAT</a>, <span class="stringliteral">&quot;test1&quot;</span>, <span class="stringliteral">&quot;test2&quot;</span>, <span class="stringliteral">&quot;test3&quot;</span>);
  <span class="keywordflow">if</span>(rc) {
    printf(<span class="stringliteral">&quot;Query builder ran out of memory. RC:%d\n&quot;</span>, rc);
  }

  printf(<span class="stringliteral">&quot;Test result:%s\n&quot;</span>, test);

  <span class="keywordflow">return</span> 0;
}
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Apr 27 2011 04:27:44 for joinFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
